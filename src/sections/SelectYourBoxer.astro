---
import ColumnBoxers from "@/components/ColumnBoxers.astro"
import Typography from "@/components/Typography.astro"
import { BOXERS } from "@/consts/boxers"
import { COUNTRIES } from "@/consts/countries"

const listOfBoxers = BOXERS.map((boxer) => {
	const { country } = boxer
	const countryName = COUNTRIES[country]?.name || ""
	return { ...boxer, countryName }
})

const boxersColumn1 = listOfBoxers.slice(0, 6)
const boxersColumn2 = listOfBoxers.slice(6, 13)

const msFadeLuchador = 150
---

<section class="my-40">
	<Typography
		as="h3"
		variant="atomic-title"
		color="primary"
		class:list={"text-center"}
		id="selectedBoxer"
	>
		elige tu luchador
	</Typography>

	<Typography as="p" variant="body" color="neutral" class="mb-16 mt-4 text-center">
		Conoce los detalles de cada boxeador
	</Typography>

	<div class="relative flex flex-row items-center justify-center gap-8">
		<article
			data-transition-duration={msFadeLuchador}
			class="absolute flex w-full flex-col items-center justify-center"
			style="view-transition-name: boxer;"
		>
			<header class="relative flex w-full flex-col items-center justify-center">
				<div
					class="absolute inset-0 -z-20 m-auto bg-center bg-no-repeat"
					style="
						background-image: url('/img/effects/boxer-background.png');
						background-size: 50%;
						mask-image: radial-gradient(circle at bottom, transparent 26%, #000 40%);
						"
				>
				</div>
				<picture
					transition:name="boxer-big-image"
					class:list={"boxer-photo h-auto object-contain px-10 sm:w-[30vw] sm:px-0 xl:w-[19vw] 3xl:h-[500px] 3xl:w-[480px]"}
				>
					<source srcset="/img/boxers/el-mariana-big.avif" type="image/avif" />
					<img
						class:list={"boxer-photo h-auto object-contain px-10 sm:w-[30vw] sm:px-0 xl:w-[19vw] 3xl:h-[500px] 3xl:w-[480px]"}
						alt="Fotografía de El Mariana"
						src="/img/boxers/el-mariana-big.avif"
						style="
							filter: drop-shadow(0 0 20px rgba(0, 0, 0, .5));
							mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
						"
					/>
				</picture>

				<div class="absolute bottom-14 max-w-md text-wrap">
					<Typography
						as="h4"
						variant="boxer-title"
						color="primary"
						class:list={"boxer-title -skew-y-6 text-center"}
					>
						el mariana
					</Typography>
				</div>
			</header>

			<footer id="boxer-footer" class="">
				<img
					class:list={`boxer-flag pointer-events-none aspect-[3/2] h-auto w-20 object-contain object-center transition duration-[${msFadeLuchador}] 3xl:w-24`}
					alt="Bandera de México"
					src="/img/flags/mx.webp"
				/>
			</footer>
		</article>
		<div class="flex w-full justify-between">
			<aside class="boxers-aside flex">
				<div class="blur"><div class="clip-black"></div></div>
				<nav class="boxers-nav">
					<ColumnBoxers boxers={boxersColumn1} />
					<ColumnBoxers boxers={boxersColumn2} clss="mt-4" />
				</nav>
			</aside>

			<aside class="boxers-aside">
				<div class="blur"><div class="clip-black"></div></div>
				<nav class="boxers-nav justify-end">
					<ColumnBoxers boxers={boxersColumn1} clss="mt-4" />
					<ColumnBoxers boxers={boxersColumn2} />
				</nav>
			</aside>
		</div>
	</div>
</section>

<script>
	const article = document.querySelector("article") as HTMLElement
	const boxerLinks = document.querySelectorAll(".boxer-link")
	const boxerTitle = document.querySelector(".boxer-title") as HTMLImageElement
	const boxerPhoto = document.querySelector(".boxer-photo") as HTMLPictureElement
	const boxerCountry = document.querySelector(".boxer-flag") as HTMLImageElement

	boxerLinks.forEach((link) => {
		link.addEventListener("mouseenter", (event) => {
			const { id, name, country, countryName } = (event.currentTarget as HTMLElement)?.dataset
			link.classList.add("active")
			setTimeout(
				() => {
					const boxerSrc = `/img/boxers/${id}-big`

					boxerPhoto.getElementsByTagName("source")[0].srcset = `${boxerSrc}.avif`
					boxerPhoto.getElementsByTagName("img")[0].src = `${boxerSrc}.webp`
					boxerTitle.innerText = name?.toLocaleLowerCase() ?? ""
					boxerCountry.src = `/img/flags/${country}.webp`

					boxerPhoto.getElementsByTagName("img")[0].alt = `Fotografía de ${name}`
					boxerCountry.alt = `Bandera de ${countryName}`
				},
				article.getAttribute("data-transition-duration") as unknown as number
			)
		})
		link.addEventListener("mouseleave", () => {
			link.classList.remove("active")
		})
	})
</script>

<style>
	.boxers-aside {
		max-width: 100vw;
		height: 8rem;
		overflow-x: scroll;
		position: relative;
		scrollbar-width: none;
	}

	.boxers-nav {
		display: flex;
		gap: 1.5rem;
		height: 100%;
		padding: 1rem 5rem;
	}

	@media (min-width: 1280px) {
		.boxers-aside {
			padding: 0.5rem 0;
			display: block;
			max-width: none;
			width: 100%;
			overflow: hidden;
			height: auto;
		}

		.boxer-image {
			@apply h-full;
		}
	}

	@media (max-width: 1650px) {
		.boxers-aside.up {
			margin-top: -15rem;
		}
	}
</style>
